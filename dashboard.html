<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dashboard Analista</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Arial;
    background:#f4f6f9;
    margin:20px;
}

h2{
    margin-bottom:20px;
}

.filtros-container{
    display:flex;
    gap:10px;
    margin-bottom:20px;
}

select,button{
    padding:8px;
    border-radius:5px;
    border:1px solid #ccc;
}

button{
    background:#1f4e79;
    color:white;
    cursor:pointer;
}

.kpis{
    display:flex;
    gap:20px;
    margin-bottom:20px;
}

.card{
    background:white;
    padding:20px;
    border-radius:8px;
    width:200px;
    text-align:center;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
}

canvas{
    background:white;
    padding:20px;
    border-radius:8px;
}
</style>
</head>

<body>

<h2>Dashboard Comercial</h2>

<!-- ðŸ”¥ FILTROS -->
<div class="filtros-container">
    <select id="filtroMes">
        <option value="0">Enero</option>
        <option value="1">Febrero</option>
        <option value="2">Marzo</option>
        <option value="3">Abril</option>
        <option value="4">Mayo</option>
        <option value="5">Junio</option>
        <option value="6">Julio</option>
        <option value="7">Agosto</option>
        <option value="8">Septiembre</option>
        <option value="9">Octubre</option>
        <option value="10">Noviembre</option>
        <option value="11">Diciembre</option>
    </select>

    <select id="filtroAnio">
        <option value="2026">2026</option>
        <option value="2025">2025</option>
    </select>

    <select id="filtroNombre">
        <option value="">Todos los analistas</option>
        <option value="AndrÃ©s">AndrÃ©s</option>
        <option value="Sara">Sara</option>
        <option value="Miguel">Miguel</option>
        <option value="Valentina">Valentina</option>
    </select>

    <button onclick="aplicarFiltro()">Aplicar</button>
</div>

<!-- KPIs -->
<div class="kpis">
    <div class="card">
        <h3>Leads</h3>
        <p id="kpiLeads">0</p>
    </div>

    <div class="card">
        <h3>Oportunidades</h3>
        <p id="kpiOpp">0</p>
    </div>

    <div class="card">
        <h3>Cierres</h3>
        <p id="kpiCierres">0</p>
    </div>

    <div class="card">
        <h3>ConversiÃ³n</h3>
        <p id="kpiConversion">0%</p>
    </div>
</div>

<canvas id="grafico" height="100"></canvas>

<script>

// ðŸ”¥ DATOS DE EJEMPLO
const datos = [
    {nombre:"AndrÃ©s", leads:20, oportunidades:10, cierres:5, fecha:"2026-01-10"},
    {nombre:"AndrÃ©s", leads:15, oportunidades:8, cierres:3, fecha:"2026-02-15"},
    {nombre:"Sara", leads:18, oportunidades:9, cierres:4, fecha:"2026-01-20"},
    {nombre:"Miguel", leads:25, oportunidades:12, cierres:6, fecha:"2026-02-05"}
];

let chart;

// ðŸ”¥ FILTRO
function aplicarFiltro(){

    const mes = document.getElementById("filtroMes").value;
    const anio = document.getElementById("filtroAnio").value;
    const nombre = document.getElementById("filtroNombre").value;

    const filtrados = datos.filter(d => {
        const fecha = new Date(d.fecha);
        return fecha.getMonth() == mes && fecha.getFullYear() == anio && (nombre === "" || d.nombre === nombre);
    });

    actualizarKPIs(filtrados);
}

// ðŸ”¥ ACTUALIZAR KPIS
function actualizarKPIs(lista){

    let totalLeads = 0;
    let totalOpp = 0;
    let totalCierres = 0;

    lista.forEach(d => {
        totalLeads += d.leads;
        totalOpp += d.oportunidades;
        totalCierres += d.cierres;
    });

    let conversion = totalOpp > 0 ? ((totalCierres/totalOpp)*100).toFixed(1) : 0;

    document.getElementById("kpiLeads").innerText = totalLeads;
    document.getElementById("kpiOpp").innerText = totalOpp;
    document.getElementById("kpiCierres").innerText = totalCierres;
    document.getElementById("kpiConversion").innerText = conversion + "%";

    actualizarGrafico(totalLeads,totalOpp,totalCierres);
}

// ðŸ”¥ GRAFICO
function actualizarGrafico(leads,opp,cierres){

    if(chart) chart.destroy();

    const ctx = document.getElementById("grafico").getContext("2d");

    chart = new Chart(ctx,{
        type:"bar",
        data:{
            labels:["Leads","Oportunidades","Cierres"],
            datasets:[{
                label:"Rendimiento",
                data:[leads,opp,cierres]
            }]
        }
    });
}

// ðŸ”¥ CARGA AUTOMATICA MES ACTUAL
window.onload = function(){
    const hoy = new Date();
    document.getElementById("filtroMes").value = hoy.getMonth();
    document.getElementById("filtroAnio").value = hoy.getFullYear();
    aplicarFiltro();
}

</script>

</body>
</html>