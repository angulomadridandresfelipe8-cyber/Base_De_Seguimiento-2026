<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dashboard Comercial 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background:#f1f5f9;
}

.header{
    background:#0f172a;
    color:white;
    padding:20px;
    font-size:22px;
    font-weight:600;
}

.container{
    padding:30px;
}

.card{
    background:white;
    padding:20px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
    margin-bottom:20px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
    gap:20px;
}

.kpi{
    font-size:30px;
    font-weight:bold;
    color:#0f172a;
}

.progress{
    background:#e5e7eb;
    border-radius:10px;
    overflow:hidden;
    height:14px;
    margin-top:10px;
}

.progress-bar{
    height:100%;
    background:linear-gradient(90deg,#2563eb,#1e40af);
    width:0%;
    transition:0.4s;
}

button{
    padding:10px 20px;
    background:#2563eb;
    border:none;
    color:white;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
}

button:hover{
    background:#1e40af;
}

input{
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
    margin-right:10px;
}

canvas{
    margin-top:20px;
}

</style>
</head>
<body>

<div class="header">
    Dashboard Comercial 2026 — Analista: <span id="analistaNombre"></span>
</div>

<div class="container">

<div class="card">
    <h3>Datos del Analista</h3>
    <input type="text" id="nombreInput" placeholder="Nombre">
    <input type="text" id="apellidoInput" placeholder="Apellido">
    <button onclick="guardarAnalista()">Guardar</button>
</div>

<div class="card">
    <h3>Cargar Archivo Excel</h3>
    <input type="file" id="excelFile">
</div>

<div class="grid">

<div class="card">
    <h4>Leads del Mes</h4>
    <div class="kpi" id="leadsMes">0</div>
</div>

<div class="card">
    <h4>Oportunidades</h4>
    <div class="kpi" id="oportunidadesMes">0</div>
</div>

<div class="card">
    <h4>Cierres</h4>
    <div class="kpi" id="cierresMes">0</div>
</div>

<div class="card">
    <h4>Conversión</h4>
    <div class="kpi" id="conversionMes">0%</div>
</div>

</div>

<div class="card">
    <h4>Meta Mensual Leads</h4>
    <input type="number" id="metaInput" placeholder="Meta mensual">
    <button onclick="guardarMeta()">Guardar Meta</button>

    <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
    </div>
</div>

<div class="card">
    <h3>Rendimiento Comercial</h3>
    <canvas id="grafica"></canvas>
</div>

</div>

<script>

let leads = 0;
let oportunidades = 0;
let cierres = 0;
let meta = 0;

const ctx = document.getElementById('grafica').getContext('2d');

const grafica = new Chart(ctx,{
    type:'bar',
    data:{
        labels:['Leads','Oportunidades','Cierres'],
        datasets:[{
            data:[0,0,0],
            backgroundColor:['#2563eb','#f59e0b','#10b981']
        }]
    },
    options:{
        responsive:true,
        plugins:{legend:{display:false}}
    }
});

function guardarAnalista(){
    const nombre = document.getElementById("nombreInput").value;
    const apellido = document.getElementById("apellidoInput").value;

    localStorage.setItem("nombre", nombre);
    localStorage.setItem("apellido", apellido);

    document.getElementById("analistaNombre").innerText = nombre + " " + apellido;
}

window.onload = function(){
    const nombre = localStorage.getItem("nombre");
    const apellido = localStorage.getItem("apellido");

    if(nombre){
        document.getElementById("analistaNombre").innerText = nombre + " " + apellido;
    }
}

document.getElementById('excelFile').addEventListener('change', function(e){

    const reader = new FileReader();
    reader.readAsBinaryString(e.target.files[0]);

    reader.onload = function(e){
        const data = e.target.result;
        const workbook = XLSX.read(data,{type:'binary'});
        const hoja = workbook.Sheets[workbook.SheetNames[0]];
        const datos = XLSX.utils.sheet_to_json(hoja);

        leads = datos.length;
        oportunidades = datos.filter(d => d.Estado === "Oportunidad").length;
        cierres = datos.filter(d => d.Estado === "Cierre").length;

        actualizar();
    }
});

function actualizar(){

    document.getElementById('leadsMes').innerText = leads;
    document.getElementById('oportunidadesMes').innerText = oportunidades;
    document.getElementById('cierresMes').innerText = cierres;

    let conversion = leads > 0 ? ((cierres/leads)*100).toFixed(1) : 0;
    document.getElementById('conversionMes').innerText = conversion + "%";

    grafica.data.datasets[0].data = [leads,oportunidades,cierres];
    grafica.update();

    if(meta > 0){
        let progreso = ((leads/meta)*100);
        document.getElementById('progressBar').style.width = progreso + "%";
    }
}

function guardarMeta(){
    meta = document.getElementById("metaInput").value;
    actualizar();
}

</script>

</body>
</html>